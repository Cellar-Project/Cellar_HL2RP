'use strict';!function(f,m,p){XF.TooltipElement=XF.create({options:{baseClass:"tooltip",extraClass:"tooltip--basic",html:!1,inViewport:!0,loadRequired:!1,loadParams:null,placement:"top"},content:null,$tooltip:null,shown:!1,shownFully:!1,placement:null,positioner:null,loadRequired:!1,loading:!1,contentApplied:!1,setupCallbacks:null,__construct:function(a,b,c){this.setupCallbacks=[];this.options=f.extend(!0,{},this.options,b);this.content=a;this.loadRequired=this.options.loadRequired;c&&this.setPositioner(c)},
setPositioner:function(a){this.positioner=a},setLoadRequired:function(a){this.loadRequired=a},addSetupCallback:function(a){this.$tooltip?a(this.$tooltip):this.setupCallbacks.push(a)},show:function(){if(!this.shown)if(this.shown=!0,this.loadRequired)this.loadContent();else{var a=this.getTooltip(),b=this;this.reposition();f(m).on("resize.tooltip-"+a.xfUniqueId(),XF.proxy(this,"reposition"));a.trigger("tooltip:shown").stop().css({visibility:"",display:"none"}).fadeIn("fast",function(){b.shownFully=!0})}},
hide:function(){if(this.shown){this.shownFully=this.shown=!1;var a=this.$tooltip;a&&(a.stop().fadeOut("fast").trigger("tooltip:hidden"),f(m).off("resize.tooltip-"+a.xfUniqueId()))}},toggle:function(){this.shown?this.hide():this.show()},destroy:function(){this.$tooltip&&this.$tooltip.remove()},isShown:function(){return this.shown},isShownFully:function(){return this.shown&&this.shownFully},requiresLoad:function(){return this.loadRequired},getPlacement:function(){return XF.rtlFlipKeyword(this.options.placement)},
reposition:function(){var a=this.positioner;if(!a)console.error("No tooltip positioner");else if(!this.loadRequired){var b=this.options.inViewport;if(a instanceof f){var c=a.dimensions(!0);a.closest(".overlay").length&&(b=!0)}else"undefined"!==typeof a[0]&&"undefined"!==typeof a[1]?c={top:a[1],right:a[0],bottom:a[1],left:a[0]}:"undefined"!==typeof a.right&&"undefined"!==typeof a.bottom?c=a:console.error("Positioner is not in correct format",a);c.width=c.right-c.left;c.height=c.bottom-c.top;a=this.getTooltip();
var d=this.getPlacement(),h=this.options.baseClass,l=d;if(b){var g=f(m);b=g.height();var k=g.width();var e=g.scrollTop();g=g.scrollLeft();e+=XF.getStickyHeaderOffset();e={top:e,left:g,right:g+k,bottom:e+b,width:k,height:b}}else e=f("body").dimensions();this.placement&&a.removeClass(h+"--"+this.placement);a.addClass(h+"--"+d).css({visibility:"hidden",display:"block",top:"",bottom:"",left:"",right:"","padding-left":"","padding-right":"","padding-top":"","padding-bottom":""});b=a.outerWidth();k=a.outerHeight();
"top"==d&&c.top-k<e.top?d="bottom":"bottom"==d&&c.bottom+k>e.bottom?c.top-k>=e.top&&(d="top"):"left"==d&&c.left-b<e.left?d=c.right+b>e.right?c.top-k<e.top?"bottom":"top":"right":"right"==d&&c.right+b>e.right&&(d=c.left-b<e.left?c.top-k<e.top?"bottom":"top":"left");d!=l&&a.removeClass(h+"--"+l).addClass(h+"--"+d);l={top:"",right:"",bottom:"",left:""};switch(d){case "top":l.bottom=f(m).height()-c.top;l.left=c.left+c.width/2-b/2;break;case "bottom":l.top=c.bottom;l.left=c.left+c.width/2-b/2;break;case "left":l.top=
c.top+c.height/2-k/2;l.right=f(m).width()-c.left;break;default:l.top=c.top+c.height/2-k/2,l.left=c.right}a.css(l);g=a.dimensions(!0);k=c=0;h=a.find("."+h+"-arrow");if("left"==d||"right"==d)g.top<e.top?c=e.top-g.top:g.bottom>e.bottom&&(c=e.bottom-g.bottom),h.css({left:"",top:50-100*c/g.top+"%"});else{g.left<e.left?k=e.left-g.left:g.left+b>e.right&&(k=e.right-(g.left+b));e=parseInt(b/100*(50-100*k/b),0);var q=e+parseInt(h.css("margin-left")),r=q+h.outerWidth();g=parseInt(a.css("padding-left"),10);var n=
parseInt(a.css("padding-right"),10);q<g?(b=g-q,a.css({"padding-left":Math.max(0,g-b),"padding-right":n+b})):r>b-n&&(b=r-(b-n),a.css({"padding-left":n+b,"padding-right":Math.max(0,n-b)}));h.css({top:"",left:e})}k?a.css("left",l.left+k):c&&a.css("top",l.top+c);this.placement=d;this.shown&&!this.loadRequired&&a.css("visibility","")}},attach:function(){this.getTooltip()},getTooltip:function(){if(!this.$tooltip){var a=this.getTemplate();a.appendTo("body");this.$tooltip=a;this.loadRequired||this.applyTooltipContent()}return this.$tooltip},
setContent:function(a){this.contentApplied=!1;this.content=a;this.applyTooltipContent()},applyTooltipContent:function(){if(this.contentApplied||this.loadRequired)return!1;var a=this.getTooltip(),b=a.find("."+this.options.baseClass+"-content"),c=this.content;f.isFunction(c)&&(c=c());this.options.html?(b.html(c),b.find("img").on("load",XF.proxy(this,"reposition"))):b.text(c);b=this.setupCallbacks;for(c=0;c<b.length;c++)b[c](a);XF.activate(a);return this.contentApplied=!0},loadContent:function(){if(this.loadRequired&&
!this.loading){var a=this.content,b=this,c=function(d){b.content=d;b.loadRequired=!1;b.loading=!1;b.applyTooltipContent();b.shown&&(b.shown=!1,b.show())};f.isFunction(a)?(this.loading=!0,a(c,this.options.loadParams)):c("")}},getTemplate:function(){var a=this.options.baseClass;return f(f.parseHTML('<div class="'+a+(this.options.extraClass?" "+this.options.extraClass:"")+'" role="tooltip"><div class="'+a+'-arrow"></div><div class="'+a+'-content"></div></div>'))}});XF.TooltipTrigger=XF.create({options:{delayIn:200,
delayInLoading:800,delayOut:200,trigger:"hover focus",maintain:!1,clickHide:null,onShow:null,onHide:null},$target:null,tooltip:null,delayTimeout:null,delayTimeoutType:null,stopFocusBefore:null,clickTriggered:!1,touchEnterTime:null,$covers:null,__construct:function(a,b,c){this.options=f.extend(!0,{},this.options,c);this.$target=a;this.tooltip=b;"auto"==this.options.trigger&&(this.options.trigger="hover focus"+(a.is("span")?" touchclick":""));b.setPositioner(a);b.addSetupCallback(XF.proxy(this,"onTooltipSetup"));
a.xfUniqueId();XF.TooltipTrigger.cache[a.attr("id")]=this},init:function(){var a=this.$target,b=!1,c=!1,d=this,h=XF.supportsPointerEvents(),l=h?"pointerenter":"mouseenter";h=h?"pointerleave":"mouseleave";null===this.options.clickHide&&(this.options.clickHide=a.is("a"));for(var g=this.options.trigger.split(" "),k=0;k<g.length;k++)switch(g[k]){case "hover":a.on(l+".tooltip",XF.proxy(this,"mouseEnter")).on(h+".tooltip",XF.proxy(this,"leave"));break;case "focus":a.on({"focusin.tooltip":XF.proxy(this,
"focusEnter"),"focusout.tooltip":XF.proxy(this,"leave")});break;case "click":b=!0;a.onPointer("click.tooltip",XF.proxy(this,"click"));a.onPointer("auxclick.tooltip contextmenu.tooltip",function(){d.cancelShow();d.stopFocusBefore=Date.now()+2E3});break;case "touchclick":c=!0;a.onPointer("click.tooltip",function(e){XF.isEventTouchTriggered(e)&&d.click(e)});break;case "touchhold":c=!0,a.data("threshold",this.options.delayIn),a.onPointer({"touchstart.tooltip":function(e){a.data("tooltip:touching",!0)},
"touchend.tooltip":function(e){setTimeout(function(){a.removeData("tooltip:touching")},50)},"taphold.tooltip":function(e){a.data("tooltip:taphold",!0);XF.isEventTouchTriggered(e)&&d.click(e)},"contextmenu.tooltip":function(e){a.data("tooltip:touching")&&e.preventDefault()}})}b&&c&&console.error("Cannot have touchclick and click triggers");if(!b&&this.options.clickHide)a.onPointer("click.tooltip auxclick.tooltip contextmenu.tooltip",function(e){c&&XF.isEventTouchTriggered(e)||(d.hide(),d.stopFocusBefore=
Date.now()+2E3)});a.on({"tooltip:show":XF.proxy(this,"show"),"tooltip:hide":XF.proxy(this,"hide"),"tooltip:reposition":XF.proxy(this,"reposition")})},reposition:function(){this.tooltip.reposition()},click:function(a){0<a.button||a.ctrlKey||a.shiftKey||a.metaKey||a.altKey?this.cancelShow():this.tooltip.isShown()?this.tooltip.isShownFully()?this.hide():(a.preventDefault(),this.clickShow(a)):(a.preventDefault(),this.clickShow(a))},clickShow:function(a){this.clickTriggered=!0;var b=this;setTimeout(function(){var c=
b.addCovers();if(XF.isEventTouchTriggered(a))c.addClass("is-active");else f(p).on("click.tooltip-"+b.$target.xfUniqueId(),XF.proxy(b,"docClick"))},0);this.show()},addCovers:function(){this.$covers&&this.$covers.remove();var a=this.$target.dimensions(!0),b=[];b.push({top:0,height:a.top,left:0,right:0});b.push({top:a.top,height:a.height,left:0,width:a.left});b.push({top:a.top,height:a.height,left:a.right,right:0});b.push({top:a.bottom,height:f("html").height()-a.bottom,left:0,right:0});a=f();for(var c,
d=0;d<b.length;d++)c=f('<div class="tooltipCover" />').css(b[d]),a=a.add(c);a.on("click",XF.proxy(this,"hide"));this.tooltip.getTooltip().before(a);this.$covers=a;XF.setRelativeZIndex(a,this.$target);return a},docClick:function(a){var b=this.$covers;var c=a.pageX;var d=a.pageY,h=f(m);b&&(0==a.screenX&&0==a.screenY&&(a=f(a.target).dimensions(),c=a.left,d=a.top),b.addClass("is-active"),c=f(p.elementFromPoint(c-h.scrollLeft(),d-h.scrollTop())),b.removeClass("is-active"),c.is(b)&&this.hide())},mouseEnter:function(a){var b=
a.originalEvent;XF.isEventTouchTriggered(a)?this.touchEnterTime=b.timeStamp:XF.browser.ios&&XF.supportsPointerEvents()&&b instanceof PointerEvent&&this.touchEnterTime&&this.touchEnterTime>b.timeStamp-1E3||this.enter()},focusEnter:function(a){100>Date.now()-XF.pageDisplayTime||XF.isEventTouchTriggered(a)||(!this.stopFocusBefore||Date.now()>=this.stopFocusBefore)&&this.enter()},enter:function(){if(!this.isShown()||!this.clickTriggered){this.clickTriggered=!1;var a=this.tooltip.requiresLoad()?this.options.delayInLoading:
this.options.delayIn;if(a){if("enter"!==this.delayTimeoutType&&this.resetDelayTimer(),!this.delayTimeoutType&&!this.isShown()){this.delayTimeoutType="enter";var b=this;this.delayTimeout=setTimeout(function(){b.delayTimeoutType=null;b.show()},a)}}else this.show()}},leave:function(){if(!this.clickTriggered){var a=this.options.delayOut;if(a){if("leave"!==this.delayTimeoutType&&this.resetDelayTimer(),!this.delayTimeoutType&&this.isShown()){this.delayTimeoutType="leave";var b=this;this.delayTimeout=setTimeout(function(){b.delayTimeoutType=
null;b.hide()},a)}}else this.hide()}},show:function(){var a=this;f(m).off("focus.tooltip-"+this.$target.xfUniqueId()).on("focus.tooltip-"+this.$target.xfUniqueId(),function(c){a.stopFocusBefore=Date.now()+250});XF.setRelativeZIndex(this.tooltip.getTooltip(),this.$target);if(this.options.onShow){var b=this.options.onShow;b(this,this.tooltip)}this.tooltip.show()},cancelShow:function(){"enter"===this.delayTimeoutType?this.resetDelayTimer():this.tooltip.isShownFully()||this.hide()},hide:function(){this.tooltip.hide();
this.resetDelayTimer();this.clickTriggered=!1;this.$covers&&(this.$covers.remove(),this.$covers=null);f(p).off("click.tooltip-"+this.$target.xfUniqueId());if(this.options.onHide){var a=this.options.onHide;a(this,this.tooltip)}},toggle:function(){this.isShown()?this.hide():this.show()},isShown:function(){return this.tooltip.isShown()},wasClickTriggered:function(){return this.clickTriggered},resetDelayTimer:function(){this.delayTimeoutType&&(clearTimeout(this.delayTimeout),this.delayTimeoutType=null)},
addMaintainElement:function(a){if(!a.data("tooltip-maintain")){for(var b=this.options.trigger.split(" "),c=0;c<b.length;c++)switch(b[c]){case "hover":a.on("mouseenter.tooltip",XF.proxy(this,"enter"));a.on("mouseleave.tooltip",XF.proxy(this,"leave"));break;case "focus":a.on("focusin.tooltip",XF.proxy(this,"enter")),a.on("focusout.tooltip",XF.proxy(this,"leave"))}a.data("tooltip-maintain",!0)}},removeMaintainElement:function(a){a.off(".tooltip");a.data("tooltip-maintain",!1)},onTooltipSetup:function(a){if(this.options.maintain){this.addMaintainElement(a);
var b=this;a.on("menu:opened",function(c,d){b.addMaintainElement(d)});a.on("menu:closed",function(c,d){b.removeMaintainElement(d)})}}});XF.TooltipTrigger.cache={};XF.TooltipOptions={base:{baseClass:"tooltip",extraClass:"tooltip--basic",html:!1,inViewport:!0,placement:"top",clickHide:null,delayIn:200,delayOut:200,maintain:!1,trigger:"hover focus"},tooltip:["baseClass","extraClass","html","placement"],trigger:["clickHide","delayIn","delayOut","maintain","trigger"],extract:function(a,b){for(var c={},
d=0;d<a.length;d++)c[a[d]]=b[a[d]];return c},extractTooltip:function(a){return this.extract(this.tooltip,a)},extractTrigger:function(a){return this.extract(this.trigger,a)}};XF.Tooltip=XF.Element.newHandler({options:f.extend(!0,{},XF.TooltipOptions.base,{content:null}),trigger:null,tooltip:null,init:function(){var a=this.getContent(),b=XF.TooltipOptions.extractTooltip(this.options),c=XF.TooltipOptions.extractTrigger(this.options);this.tooltip=new XF.TooltipElement(a,b);this.trigger=new XF.TooltipTrigger(this.$target,
this.tooltip,c);this.trigger.init();this.$target.on("tooltip:refresh",XF.proxy(this,"refresh"))},getContent:function(){if(this.options.content)return this.options.content;var a=this.$target,b=a.attr("data-original-title")||a.attr("title")||"";a.attr("data-original-title",b).removeAttr("title");a.attr("aria-label")||a.attr("aria-labelledby")||f.trim(a[0].textContent).length||a.attr("aria-label",b);return b},refresh:function(){this.tooltip.setContent(this.getContent())}});XF.ElementTooltip=XF.extend(XF.Tooltip,
{__backup:{getContent:"_getContent",init:"_init"},options:f.extend({},XF.Tooltip.prototype.options,{element:null,showError:!0,noTouch:!0,shortcut:null}),$element:null,init:function(){this.options.shortcut&&this.setupShortcut(this.options.shortcut);if(!this.options.noTouch||!XF.Feature.has("touchevents")){var a=this.options.element,b=this.options.showError;if(a){var c=XF.findRelativeIf(a,this.$target);c.length?(this.$element=c,this.$target.removeAttr("title"),this.options.html=!0,this._init()):b&&
console.error("Element tooltip could not find "+a)}else b&&console.error("No element specified for the element tooltip")}},setupShortcut:function(a){"node-description"==a&&(this.options.element||(this.options.element="< .js-nodeMain | .js-nodeDescTooltip"),this.options.showError=!1,this.options.maintain=!0,this.options.placement="right",this.options.extraClass="tooltip--basic tooltip--description")},getContent:function(){return this.$element.clone().contents()}});XF.PreviewTooltip=XF.Element.newHandler({options:{delay:600,
previewUrl:null},trigger:null,tooltip:null,init:function(){this.options.previewUrl?(this.tooltip=new XF.TooltipElement(XF.proxy(this,"getContent"),{extraClass:"tooltip--preview",html:!0,loadRequired:!0}),this.trigger=new XF.TooltipTrigger(this.$target,this.tooltip,{maintain:!0,delayInLoading:this.options.delay,delayIn:this.options.delay}),this.trigger.init()):console.error("No preview URL")},getContent:function(a){var b=this;XF.ajax("get",this.options.previewUrl,{},function(c){b.loaded(c,a)},{skipDefault:!0,
skipError:!0,global:!1})},loaded:function(a,b){a.html&&XF.setupHtmlInsert(a.html,function(c,d,h){b(c)})}});XF.MemberTooltipCache={};XF.MemberTooltip=XF.Element.newHandler({options:{delay:600},trigger:null,tooltip:null,userId:null,init:function(){this.userId=this.$target.data("user-id");this.tooltip=new XF.TooltipElement(XF.proxy(this,"getContent"),{extraClass:"tooltip--member",html:!0,loadRequired:!0});this.trigger=new XF.TooltipTrigger(this.$target,this.tooltip,{maintain:!0,delayInLoading:this.options.delay,
delayIn:this.options.delay,trigger:"hover focus click",onShow:XF.proxy(this,"onShow"),onHide:XF.proxy(this,"onHide")});this.trigger.init()},getContent:function(a){var b=XF.MemberTooltipCache[this.userId];if(b)b=f(f.parseHTML(b)),a(b);else{var c=this;b={skipDefault:!0,skipError:!0,global:!1};this.trigger.wasClickTriggered()&&(b.global=!0);XF.ajax("get",this.$target.attr("href"),{tooltip:!0},function(d){c.loaded(d,a)},b)}},loaded:function(a,b){if(a.html){var c=this.userId;XF.setupHtmlInsert(a.html,
function(d,h,l){XF.MemberTooltipCache[c]=a.html.content;b(d)})}},onShow:function(){var a=XF.MemberTooltip.activeTooltip;a&&a!==this&&a.hide();XF.MemberTooltip.activeTooltip=this},onHide:function(){XF.MemberTooltip.activeTooltip===this&&(XF.MemberTooltip.activeTooltip=null)},show:function(){this.trigger.show()},hide:function(){this.trigger.hide()}});XF.MemberTooltip.activeTooltip=null;XF.ShareTooltip=XF.Element.newHandler({options:{delay:300,href:null,webShare:!0},trigger:null,tooltip:null,init:function(){if(this.options.webShare&&
XF.Element.applyHandler(this.$target,"web-share",{fetch:this.options.href,url:this.$target.attr("href"),hideContainerEls:!1}).isSupported())return!1;this.tooltip=new XF.TooltipElement(XF.proxy(this,"getContent"),{extraClass:"tooltip--share",html:!0,loadRequired:!0});this.trigger=new XF.TooltipTrigger(this.$target,this.tooltip,{maintain:!0,delayInLoading:this.options.delay,delayIn:this.options.delay,trigger:"hover focus click",onShow:XF.proxy(this,"onShow"),onHide:XF.proxy(this,"onHide")});this.trigger.init()},
getContent:function(a){var b=this,c={skipDefault:!0,skipError:!0,global:!1};this.trigger.wasClickTriggered()&&(c.global=!0);XF.ajax("get",this.options.href,{},function(d){b.loaded(d,a)},c)},loaded:function(a,b){a.html&&XF.setupHtmlInsert(a.html,function(c,d,h){b(c)})},onShow:function(){var a=XF.ShareTooltip.activeTooltip;a&&a!==this&&a.hide();XF.ShareTooltip.activeTooltip=this},onHide:function(){XF.ShareTooltip.activeTooltip===this&&(XF.ShareTooltip.activeTooltip=null)},show:function(){this.trigger.show()},
hide:function(){this.trigger.hide()}});XF.ShareTooltip.activeTooltip=null;XF.Element.register("element-tooltip","XF.ElementTooltip");XF.Element.register("member-tooltip","XF.MemberTooltip");XF.Element.register("preview-tooltip","XF.PreviewTooltip");XF.Element.register("share-tooltip","XF.ShareTooltip");XF.Element.register("tooltip","XF.Tooltip")}(jQuery,window,document);
