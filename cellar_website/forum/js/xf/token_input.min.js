'use strict';!function(g,l,m,n){XF.TokenInput=XF.Element.newHandler({options:{tokens:[","],minLength:2,maxLength:0,maxTokens:0,selectOnClose:!1,acUrl:"",listData:{}},$container:null,$selection:null,$hiddenInput:null,init:function(){var a=this.$target,b=this.options,c=a.clone().insertAfter(a).prop("type","hidden").removeAttr("data-xf-init").removeAttr("id"),d={tags:!0,width:"100%",containerCssClass:"input",language:XF.TokenInput.Phrases,minimumInputLength:b.minLength,maximumInputLength:b.maxLength,
maximumSelectionLength:b.maxTokens,selectOnClose:b.selectOnClose,disabled:a.prop("disabled"),placeholder:this.$target.attr("placeholder")};try{d.tokenSeparators=g.parseJSON(b.tokens)}catch(f){d.tokenSeparators=b.tokens}b.acUrl&&(d.ajax={delay:250,data:XF.proxy(this,"prepareAjax"),transport:XF.proxy(this,"getAjax"),processResults:XF.proxy(this,"processAjax")},d.escapeMarkup=function(f){return f},d.sorter=XF.proxy(this,"sortResults"),d.templateResult=XF.proxy(this,"prepareResults"),d.templateSelection=
XF.proxy(this,"prepareSelection"));if(b.listData){var k=[];g.each(b.listData,function(f,h){k.push({id:f,text:h})});d.data=k}a.remove();var e=g('<select name="tokens_select" multiple="multiple" class="js-tokenSelect"></select>').insertBefore(c).select2(d);c.val()&&(b=c.val().split(",").map(g.trim),g.each(b,function(f,h){f=e.find('option[value="'+h.replace(/"/g,'\\"')+'"]');f.length?f.prop("selected",!0):g("<option selected>").val(h).text(h).appendTo(e)}),e.trigger("change"));this.$hiddenInput=c;c=
e.data("select2");this.$container=c.$container;this.$selection=c.$selection;c.on("results:message",function(f){this.dropdown._resizeDropdown();this.dropdown._positionDropdown()});a.attr("autofocus")&&(e.select2("open"),c.$selection.addClass("is-focused"));a=e.closest(".overlay-container");if(a.length)a.on("overlay:hiding",function(){e.select2("close")});e.on("select2:unselecting",function(f){XF.MenuWatcher.preventDocClick()});e.on("select2:unselect",function(f){setTimeout(function(){XF.MenuWatcher.allowDocClick()},
0)});c.$container.on("focusin focusout",XF.proxy(this,"inputFocusBlur"));e.on("change",XF.proxy(this,"updateInput"));e.closest("form").on("reset",function(){e.val(null).trigger("change")})},prepareAjax:function(a){return{q:a.term}},getAjax:function(a,b,c){return XF.ajax("get",this.options.acUrl,a.data,b)},processAjax:function(a,b){return"object"!=typeof a?{}:a},sortResults:function(a){if(1>=a.length)return a;a.hasOwnProperty(0)&&(a[0].hasOwnProperty("q")||a.push(a.shift()));return a},prepareResults:function(a){a.styledText=
a.text;if(a.q){var b=new RegExp("("+XF.regexQuote(a.q)+")","i");a.styledText=XF.htmlspecialchars(a.styledText).replace(b,"<strong>$1</strong>")}else a.disabled||(a.styledText="<strong>"+XF.htmlspecialchars(a.styledText)+"</strong>");b=a.styledText;a.iconHtml&&(b=a.iconHtml+"&nbsp;"+b);return b},prepareSelection:function(a){return XF.htmlspecialchars(a.text)},inputFocusBlur:function(a){switch(a.type){case "focusout":this.$selection.removeClass("is-focused");break;default:this.$selection.addClass("is-focused")}},
updateInput:function(a){a=g(a.target);var b=this.$hiddenInput;a.val()?b.val(a.val().join(", ")):b.val("")}});XF.TokenInputSelect=XF.Element.newHandler({options:{removeDisabled:!0},init:function(){var a=this,b={width:"100%",containerCssClass:"input",language:XF.TokenInput.Phrases,disabled:this.$target.prop("disabled"),placeholder:this.$target.attr("placeholder"),matcher:function(c,d){c=g.fn.select2.defaults.defaults.matcher(c,d);if(!c)return null;if(a.options.removeDisabled){if(c.disabled)return null;
if(c.children){for(d=c.children.length-1;0<=d;d--)c.children[d].disabled&&c.children.splice(d,1);if(!c.children.length)return null}}return c}};this.$target.on("select:refresh",XF.proxy(this,"refresh")).select2(b)},refresh:function(){var a=this.$target,b=a.data("select2").dataAdapter,c=a.children();a.empty();b.addOptions(c)}});XF.TokenInput.Phrases={errorLoading:function(){return XF.phrase("s2_error_loading")},inputTooLong:function(a){return XF.phrase("s2_input_too_long",{"{count}":a.input.length-
a.maximum})},inputTooShort:function(a){return XF.phrase("s2_input_too_short",{"{count}":a.minimum-a.input.length})},loadingMore:function(){return XF.phrase("s2_loading_more")},maximumSelected:function(a){return XF.phrase("s2_maximum_selected",{"{count}":a.maximum})},noResults:function(){return XF.phrase("s2_no_results")},searching:function(){return XF.phrase("s2_searching")}};XF.Element.register("token-input","XF.TokenInput");XF.Element.register("token-input-select","XF.TokenInputSelect")}(jQuery,
window,document);
