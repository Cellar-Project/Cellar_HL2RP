/*!
 * froala_editor v4.0.10 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2022 Froala Labs
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=e&&e.hasOwnProperty("default")?e.default:e,Object.assign(e.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),Object.assign(e.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageCaption","imageRemove","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadToAzure:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","webp"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered","fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5,imageAddNewLine:!1}),e.IMAGE_ALLOW_REGEX=/\.(gif|jpe?g|tiff?|png|webp|bmp)$/i,e.PLUGINS.image=function(a){var i,r,n,o,s,l,p=a.$,g="https://i.froala.com/upload",f=!1,c=1,d=2,u=3,m=4,h=5,v=6,b={};function y(){var e=a.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val(""),i&&e.val(i.attr("src")),e.trigger("change")}function w(e){return window.pageYOffset+e.get(0).getBoundingClientRect().top}function A(){var e=a.popups.get("image.edit");if(e||(e=N()),e){var t=i;a.popups.setContainer("image.edit",a.$sc),a.popups.refresh("image.edit");var r=t.offset().left+t.outerWidth()/2,n=t&&w(t),o=a.$wp&&w(a.$wp);o||(o=n);var s=0;a.opts.iframe?((s=a.$wp.scrollTop()+e.outerHeight())<t.get(0).getBoundingClientRect().top&&(s=t.get(0).getBoundingClientRect().top),s>t.get(0).getBoundingClientRect().top+t.height()&&(s=t.get(0).getBoundingClientRect().top+t.height())):s=n>o?n:a.$wp&&n+t.height()<o+a.$wp.height()?n+t.height():o+e.outerHeight(),i.hasClass("fr-uploading")?B():a.popups.show("image.edit",r,s,1,!0)}}function C(){O()}function S(e){e.parents(".fr-img-caption").length>0&&(e=e.parents(".fr-img-caption").first()),e.hasClass("fr-dii")||e.hasClass("fr-dib")||(e.addClass("fr-fi".concat(be(e)[0])),e.addClass("fr-di".concat(ye(e)[0])),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align",""))}function E(e){e.parents(".fr-img-caption").length>0&&(e=e.parents(".fr-img-caption").first()),ve(e,e.hasClass("fr-dib")?"block":e.hasClass("fr-dii")?"inline":null,e.hasClass("fr-fil")?"left":e.hasClass("fr-fir")?"right":be(e)),e.removeClass("fr-dib fr-dii fr-fir fr-fil")}function R(){for(var e="IMG"==a.el.tagName?[a.el]:a.el.querySelectorAll("img"),t=0;t<e.length;t++){var i=p(e[t]);!a.opts.htmlUntouched&&a.opts.useClasses?((a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)&&S(i),a.opts.imageTextNear||(i.parents(".fr-img-caption").length>0?i.parents(".fr-img-caption").first().removeClass("fr-dii").addClass("fr-dib"):i.removeClass("fr-dii").addClass("fr-dib"))):a.opts.htmlUntouched||a.opts.useClasses||(a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)&&E(i),a.opts.iframe&&i.on("load",a.size.syncIframe)}}function U(e){void 0===e&&(e=!0);var t,i=Array.prototype.slice.call(a.el.querySelectorAll("img")),r=[];for(t=0;t<i.length;t++)if(r.push(i[t].getAttribute("src")),p(i[t]).toggleClass("fr-draggable",a.opts.imageMove),""===i[t].getAttribute("class")&&i[t].removeAttribute("class"),""===i[t].getAttribute("style")&&i[t].removeAttribute("style"),i[t].parentNode&&i[t].parentNode.parentNode&&a.node.hasClass(i[t].parentNode.parentNode,"fr-img-caption")){var n=i[t].parentNode.parentNode;a.browser.mozilla||n.setAttribute("contenteditable",!1),n.setAttribute("draggable",!1),n.classList.add("fr-draggable");var o=i[t].nextSibling;o&&!a.browser.mozilla&&o.setAttribute("contenteditable",!0)}if(s)for(t=0;t<s.length;t++)r.indexOf(s[t].getAttribute("src"))<0&&a.events.trigger("image.removed",[p(s[t])]);if(s&&e){var l=[];for(t=0;t<s.length;t++)l.push(s[t].getAttribute("src"));for(t=0;t<i.length;t++)l.indexOf(i[t].getAttribute("src"))<0&&a.events.trigger("image.loaded",[p(i[t])])}s=i}function x(){if(r||function(){var t;a.shared.$image_resizer?(r=a.shared.$image_resizer,o=a.shared.$img_overlay,a.events.on("destroy",function(){p("body").first().append(r.removeClass("fr-active"))},!0)):(a.shared.$image_resizer=p(document.createElement("div")).attr("class","fr-image-resizer"),r=a.shared.$image_resizer,a.events.$on(r,"mousedown",function(e){e.stopPropagation()},!0),a.opts.imageResize&&(r.append(D("nw")+D("ne")+D("sw")+D("se")),a.shared.$img_overlay=p(document.createElement("div")).attr("class","fr-image-overlay"),o=a.shared.$img_overlay,t=r.get(0).ownerDocument,p(t).find("body").first().append(o)));a.events.on("shared.destroy",function(){r.html("").removeData().remove(),r=null,a.opts.imageResize&&(o.remove(),o=null)},!0),a.helpers.isMobile()||a.events.$on(p(a.o_win),"resize",function(){i&&!i.hasClass("fr-uploading")?de(!0):i&&(x(),we(),B(!1))});if(a.opts.imageResize){t=r.get(0).ownerDocument,a.events.$on(r,a._mousedown,".fr-handler",$),a.events.$on(p(t),a._mousemove,I),a.events.$on(p(t.defaultView||t.parentWindow),a._mouseup,P),a.events.$on(o,"mouseleave",P);var n=1,s=null,l=0;a.events.on("keydown",function(t){if(i){var r=-1!=navigator.userAgent.indexOf("Mac OS X")?t.metaKey:t.ctrlKey,o=t.which;(o!==s||t.timeStamp-l>200)&&(n=1),(o==e.KEYCODE.EQUALS||a.browser.mozilla&&o==e.KEYCODE.FF_EQUALS)&&r&&!t.altKey?n=ie.call(this,t,1,1,n):(o==e.KEYCODE.HYPHEN||a.browser.mozilla&&o==e.KEYCODE.FF_HYPHEN)&&r&&!t.altKey?n=ie.call(this,t,2,-1,n):a.keys.ctrlKey(t)||o!=e.KEYCODE.ENTER||(i.before("<br>"),_(i)),s=o,l=t.timeStamp}},!0),a.events.on("keyup",function(){n=1})}}(),!i)return!1;var t=a.$wp||a.$sc;t.append(r),r.data("instance",a);var n=t.scrollTop()-("static"!=t.css("position")?t.offset().top:0),s=t.scrollLeft()-("static"!=t.css("position")?t.offset().left:0);s-=a.helpers.getPX(t.css("border-left-width")),n-=a.helpers.getPX(t.css("border-top-width")),a.$el.is("img")&&a.$sc.is("body")&&(n=0,s=0);var l=Se();Ee()&&(l=l.find(".fr-img-wrap"));var g=0,f=0;a.opts.iframe&&(g=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),f=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left"))),r.css("top",(a.opts.iframe?l.offset().top+g:l.offset().top+n)-1).css("left",(a.opts.iframe?l.offset().left+f:l.offset().left+s)-1).css("width",l.get(0).getBoundingClientRect().width).css("height",l.get(0).getBoundingClientRect().height).addClass("fr-active")}function D(e){return'<div class="fr-handler fr-h'.concat(e,'"></div>')}function T(e){Ee()?i.parents(".fr-img-caption").css("width",e):i.css("width",e)}function $(e){if(!a.core.sameInstance(r))return!0;if(e.preventDefault(),e.stopPropagation(),a.$el.find("img.fr-error").left)return!1;a.undo.canDo()||a.undo.saveStep();var t=e.pageX||e.originalEvent.touches[0].pageX;if("mousedown"==e.type){var s=a.$oel.get(0).ownerDocument,l=s.defaultView||s.parentWindow,g=!1;try{g=l.location!=l.parent.location&&!(l.$&&l.$.FE)}catch(e){}g&&l.frameElement&&(t+=a.helpers.getPX(p(l.frameElement).offset().left)+l.frameElement.clientLeft)}(n=p(this)).data("start-x",t),n.data("start-width",i.width()),n.data("start-height",i.height());var f=i.width();if(a.opts.imageResizeWithPercent){var c=i.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el;f=(f/p(c).outerWidth()*100).toFixed(2)+"%"}T(f),o.show(),a.popups.hideAll(),he()}function I(e){if(!a.core.sameInstance(r))return!0;var t;if(n&&i){if(e.preventDefault(),a.$el.find("img.fr-error").left)return!1;var o=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null);if(!o)return!1;var s=o-n.data("start-x"),l=n.data("start-width");if((n.hasClass("fr-hnw")||n.hasClass("fr-hsw"))&&(s=0-s),a.opts.imageResizeWithPercent){var g=i.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el;l=((l+s)/p(g).outerWidth()*100).toFixed(2),a.opts.imageRoundPercent&&(l=Math.round(l)),T("".concat(l,"%")),(t=Ee()?(a.helpers.getPX(i.parents(".fr-img-caption").css("width"))/p(g).outerWidth()*100).toFixed(2):(a.helpers.getPX(i.css("width"))/p(g).outerWidth()*100).toFixed(2))===l||a.opts.imageRoundPercent||T("".concat(t,"%")),i.css("height","").removeAttr("height")}else l+s>=a.opts.imageMinWidth&&(T(l+s),t=Ee()?a.helpers.getPX(i.parents(".fr-img-caption").css("width")):a.helpers.getPX(i.css("width"))),t!==l+s&&T(t),((i.attr("style")||"").match(/(^height:)|(; *height:)/)||i.attr("height"))&&(i.css("height",n.data("start-height")*i.width()/n.data("start-width")),i.removeAttr("height"));x(),a.events.trigger("image.resize",[Ce()])}}function P(e){if(!a.core.sameInstance(r))return!0;if(n&&i){if(e&&e.stopPropagation(),a.$el.find("img.fr-error").left)return!1;n=null,o.hide(),x(),A(),a.undo.saveStep(),a.events.trigger("image.resizeEnd",[Ce()])}else r.removeClass("fr-active")}function k(e,t,r){a.edit.on(),i&&i.addClass("fr-error"),b[e]?L(a.language.translate(b[e])):L(a.language.translate("Something went wrong. Please try again.")),!i&&r&&re(r),a.events.trigger("image.error",[{code:e,message:b[e]},t,r])}function N(e){if(e)return a.$wp&&a.events.$on(a.$wp,"scroll.image-edit",function(){i&&a.popups.isVisible("image.edit")&&(a.events.disableBlur(),A())}),!0;var t="";if(a.opts.imageEditButtons.length>0){var r={buttons:t+='<div class="fr-buttons">\n        '.concat(a.button.buildList(a.opts.imageEditButtons),"\n        </div>")};return a.popups.create("image.edit",r)}return!1}function B(e){var t=a.popups.get("image.insert");if(t||(t=j()),t.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").addClass("fr-active"),t.find(".fr-buttons").hide(),i){var r=Se();a.popups.setContainer("image.insert",a.$sc);var n=r.offset().left,o=r.offset().top+r.height();a.popups.show("image.insert",n,o,r.outerHeight())}void 0===e&&z(a.language.translate("Uploading"),0)}function O(e){var t=a.popups.get("image.insert");if(t&&(t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").removeClass("fr-active"),t.find(".fr-buttons").show(),e||a.$el.find("img.fr-error").length)){if(a.events.focus(),a.$el.find("img.fr-error").length&&(a.$el.find("img.fr-error").remove(),a.undo.saveStep(),a.undo.run(),a.undo.dropRedo()),!a.$wp&&i){var r=i;de(!0),a.selection.setAfter(r.get(0)),a.selection.restore()}a.popups.hide("image.insert")}}function z(e,t){var i=a.popups.get("image.insert");if(i){var r=i.find(".fr-image-progress-bar-layer");r.find("h3").text(e+(t?" ".concat(t,"%"):"")),r.removeClass("fr-error"),t?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width","".concat(t,"%"))):r.find("div").addClass("fr-indeterminate")}}function L(e){B();var t=a.popups.get("image.insert").find(".fr-image-progress-bar-layer");t.addClass("fr-error");var i=t.find("h3");i.text(e),a.events.disableBlur(),i.focus()}function _(e){ce.call(e.get(0))}function M(){var e=p(this);a.popups.hide("image.insert"),e.removeClass("fr-uploading"),e.next().is("br")&&e.next().remove(),_(e),a.events.trigger("image.loaded",[e])}function K(e,t,i,r,n){r&&"string"==typeof r&&(r=a.$(r)),a.edit.off(),z(a.language.translate("Loading image")),t&&(e=a.helpers.sanitizeURL(e));var o=new Image;o.onload=function(){var t,o;if(r){a.undo.canDo()||r.hasClass("fr-uploading")||a.undo.saveStep();var s=r.data("fr-old-src");r.data("fr-image-pasted")&&(s=null),a.$wp?((t=r.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),s&&r.attr("src",s),!a.opts.trackChangesEnabled||r[0].parentNode&&"SPAN"===r[0].parentNode.tagName&&r[0].parentNode.hasAttribute("data-tracking")||a.track_changes.replaceSpecialItem(r),r.replaceWith(t)):t=r;for(var l=t.get(0).attributes,p=0;p<l.length;p++){var g=l[p];0===g.nodeName.indexOf("data-")?t.removeAttr(g.nodeName):i&&i.hasOwnProperty(g.nodeName)&&t.removeAttr(g.nodeName)}if(void 0!==i)for(o in i)i.hasOwnProperty(o)&&"link"!=o&&t.attr("".concat(o),i[o]);t.on("load",M),t.attr("src",e),a.edit.on(),U(!1),r[0].src!=e&&a.selection.restore(),a.undo.saveStep(),a.events.disableBlur(),a.$el.blur(),a.events.trigger(s?"image.replaced":"image.inserted",[t,n])}else(t=H(e,i,M))&&(U(!1),a.undo.saveStep(),a.events.disableBlur(),a.$el.blur(),a.events.trigger("image.inserted",[t,n]))},o.onerror=function(){k(c)},B(a.language.translate("Loading image")),o.src=e}function Y(e,t,i){z(a.language.translate("Loading image"));var r=this.status,n=this.response,o=this.responseXML,s=this.responseText;try{if(a.opts.imageUploadToS3||a.opts.imageUploadToAzure)if(201==r){var l;if(a.opts.imageUploadToAzure){if(!1===a.events.trigger("image.uploadedToAzure",[this.responseURL,i,n],!0))return a.edit.on(),!1;l=t}else l=function(e){try{var t=p(e).find("Location").text(),i=p(e).find("Key").text();return!1===a.events.trigger("image.uploadedToS3",[t,i,e],!0)?(a.edit.on(),!1):t}catch(t){return k(m,e),!1}}(o);l&&K(l,!1,[],e,n||o)}else k(m,n||o,e);else if(r>=200&&r<300){var g=function(e){try{if(!1===a.events.trigger("image.uploaded",[e],!0))return a.edit.on(),!1;var t=JSON.parse(e);return t.link?t:(k(d,e),!1)}catch(t){return k(m,e),!1}}(s);g&&K(g.link,!1,g,e,n||s)}else k(u,n||s,e)}catch(t){k(m,n||s,e)}}function W(){k(m,this.response||this.responseText||this.responseXML)}function G(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;z(a.language.translate("Uploading"),t)}}function H(e,t,i){var r,n=p(document.createElement("img")).attr("src",e);if(t&&void 0!==t)for(r in t)t.hasOwnProperty(r)&&"link"!=r&&(" data-".concat(r,'="').concat(t[r],'"'),n.attr("".concat(r),t[r]));var o=a.opts.imageDefaultWidth;o&&"auto"!=o&&(o=a.opts.imageResizeWithPercent?"100%":"".concat(o,"px")),n.attr("style",o?"width: ".concat(o,";"):""),ve(n,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign),n.on("load",i),n.on("error",i),a.edit.on(),a.events.focus(!0),a.selection.restore(),a.undo.saveStep(),a.opts.imageSplitHTML?a.markers.split():a.markers.insert(),a.html.wrap();var s=a.$el.find(".fr-marker");if(s.length)(s.parent().is("hr")||s.parent().is("IMG"))&&s.parent().after(s),a.node.isLastSibling(s)&&s.parent().hasClass("fr-deletable")&&s.insertAfter(s.parent()),s.replaceWith(n);else{if(a.opts.trackChangesEnabled)return O(!0),!1;a.$el.append(n)}return a.selection.clear(),n}function V(){a.edit.on(),O(!0)}function X(e,t){if(void 0!==e&&e.length>0){if(!1===a.events.trigger("image.beforeUpload",[e,t]))return!1;var r,n=e[0];if(!(null!==a.opts.imageUploadURL&&a.opts.imageUploadURL!=g||a.opts.imageUploadToS3||a.opts.imageUploadToAzure))return function(e,t){var i=new FileReader;i.onload=function(){var r=i.result;if(i.result.indexOf("svg+xml")<0){for(var n=atob(i.result.split(",")[1]),o=[],s=0;s<n.length;s++)o.push(n.charCodeAt(s));r=window.URL.createObjectURL(new Blob([new Uint8Array(o)],{type:e.type})),t&&t.data("fr-old-src",t.attr("src")),a.image.insert(r,!1,null,t)}else a.image.insert(r,null,null,a.image.get())},B(),i.readAsDataURL(e)}(n,t||i),!1;if(n.name||(n.name=(new Date).getTime()+"."+(n.type||"image/jpeg").replace(/image\//g,"")),n.size>a.opts.imageMaxSize)return k(h),!1;if(a.opts.imageAllowedTypes.indexOf(n.type.replace(/image\//g,""))<0)return k(v),!1;if(a.drag_support.formdata&&(r=a.drag_support.formdata?new FormData:null),r){var o;if(!1!==a.opts.imageUploadToS3)for(o in r.append("key",a.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(n.name||"untitled")),r.append("success_action_status","201"),r.append("X-Requested-With","xhr"),r.append("Content-Type",n.type),a.opts.imageUploadToS3.params)a.opts.imageUploadToS3.params.hasOwnProperty(o)&&r.append(o,a.opts.imageUploadToS3.params[o]);for(o in a.opts.imageUploadParams)a.opts.imageUploadParams.hasOwnProperty(o)&&r.append(o,a.opts.imageUploadParams[o]);r.append(a.opts.imageUploadParam,n,n.name);var s,l,f=a.opts.imageUploadURL,c=a.opts.imageUploadMethod;a.opts.imageUploadToS3&&(f=a.opts.imageUploadToS3.uploadURL?a.opts.imageUploadToS3.uploadURL:"https://".concat(a.opts.imageUploadToS3.region,".amazonaws.com/").concat(a.opts.imageUploadToS3.bucket)),a.opts.imageUploadToAzure&&(s=f=a.opts.imageUploadToAzure.uploadURL?"".concat(a.opts.imageUploadToAzure.uploadURL,"/").concat(n.name):encodeURI("https://".concat(a.opts.imageUploadToAzure.account,".blob.core.windows.net/").concat(a.opts.imageUploadToAzure.container,"/").concat(n.name)),a.opts.imageUploadToAzure.SASToken&&(f+=a.opts.imageUploadToAzure.SASToken),c="PUT");var d=a.core.getXHR(f,c);if(a.opts.imageUploadToAzure){var u=(new Date).toUTCString();if(!a.opts.imageUploadToAzure.SASToken&&a.opts.imageUploadToAzure.accessKey){var m=a.opts.imageUploadToAzure.account,b=a.opts.imageUploadToAzure.container;if(a.opts.imageUploadToAzure.uploadURL){var y=a.opts.imageUploadToAzure.uploadURL.split("/");b=y.pop(),m=y.pop().split(".")[0]}var w="x-ms-blob-type:BlockBlob\nx-ms-date:".concat(u,"\nx-ms-version:2019-07-07"),A=encodeURI("/"+m+"/"+b+"/"+n.name),C=c+"\n\n\n"+n.size+"\n\n"+n.type+"\n\n\n\n\n\n\n"+w+"\n"+A,S=a.cryptoJSPlugin.cryptoJS.HmacSHA256(C,a.cryptoJSPlugin.cryptoJS.enc.Base64.parse(a.opts.imageUploadToAzure.accessKey)).toString(a.cryptoJSPlugin.cryptoJS.enc.Base64),E="SharedKey "+m+":"+S;l=S,d.setRequestHeader("Authorization",E)}for(o in d.setRequestHeader("x-ms-version","2019-07-07"),d.setRequestHeader("x-ms-date",u),d.setRequestHeader("Content-Type",n.type),d.setRequestHeader("x-ms-blob-type","BlockBlob"),a.opts.imageUploadParams)a.opts.imageUploadParams.hasOwnProperty(o)&&d.setRequestHeader(o,a.opts.imageUploadParams[o]);for(o in a.opts.imageUploadToAzure.params)a.opts.imageUploadToAzure.params.hasOwnProperty(o)&&d.setRequestHeader(o,a.opts.imageUploadToAzure.params[o])}!function(e,t,i,r,n,o){function s(){var s=p(this);s.off("load"),s.addClass("fr-uploading"),s.next().is("br")&&s.next().remove(),a.placeholder.refresh(),_(s),x(),B(),a.edit.off(),e.onload=function(){Y.call(e,s,n,o)},e.onerror=W,e.upload.onprogress=G,e.onabort=V,p(s.off("abortUpload")).on("abortUpload",function(){4!=e.readyState&&(e.abort(),r?(r.attr("src",r.data("fr-old-src")),r.removeClass("fr-uploading")):s.remove(),de(!0))}),e.send(a.opts.imageUploadToAzure?i:t)}var l=new FileReader;l.onload=function(){var e=l.result;if(l.result.indexOf("svg+xml")<0){for(var t=atob(l.result.split(",")[1]),i=[],n=0;n<t.length;n++)i.push(t.charCodeAt(n));e=window.URL.createObjectURL(new Blob([new Uint8Array(i)],{type:"image/jpeg"}))}r?(r.on("load",s),r.on("error",function(){s(),p(this).off("error")}),a.edit.on(),a.undo.saveStep(),r.data("fr-old-src",r.attr("src")),r.attr("src",e)):H(e,null,s)},l.readAsDataURL(i)}(d,r,n,t||i,s,l)}}}function F(e){if(e.is("img")&&e.parents(".fr-img-caption").length>0)return e.parents(".fr-img-caption")}function q(t){var i=t.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var r=i.files[0];if(r&&r.type&&-1!==r.type.indexOf("image")&&a.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))>=0){if(!a.opts.imageUpload)return t.preventDefault(),t.stopPropagation(),!1;a.markers.remove(),a.markers.insertAtPoint(t.originalEvent),a.$el.find(".fr-marker").replaceWith(e.MARKERS),0===a.$el.find(".fr-marker").length&&a.selection.setAtEnd(a.el),a.popups.hideAll();var n=a.popups.get("image.insert");n||(n=j()),a.popups.setContainer("image.insert",a.$sc);var o=t.originalEvent.pageX,s=t.originalEvent.pageY;if(a.opts.iframe){var l=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),p=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left"));s+=a.$iframe.offset().top+l,o+=a.$iframe.offset().left+p}return a.popups.show("image.insert",o,s),B(),a.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))>=0?(de(!0),X(i.files)):k(v),t.preventDefault(),t.stopPropagation(),!1}}}function j(e){if(e)return a.popups.onRefresh("image.insert",y),a.popups.onHide("image.insert",C),!0;var t,r,n="";a.opts.imageUpload||-1===a.opts.imageInsertButtons.indexOf("imageUpload")||a.opts.imageInsertButtons.splice(a.opts.imageInsertButtons.indexOf("imageUpload"),1);var o=a.button.buildList(a.opts.imageInsertButtons);""!==o&&(n='<div class="fr-buttons fr-tabs">'.concat(o,"</div>"));var s=a.opts.imageInsertButtons.indexOf("imageUpload"),l=a.opts.imageInsertButtons.indexOf("imageByURL"),g="";s>=0&&(t=" fr-active",l>=0&&s>l&&(t=""),g='<div class="fr-image-upload-layer'.concat(t,' fr-layer" id="fr-image-upload-layer-').concat(a.id,'"><strong>').concat(a.language.translate("Drop image"),"</strong><br>(").concat(a.language.translate("or click"),')<div class="fr-form"><input type="file" accept="image/').concat(a.opts.imageAllowedTypes.join(", image/").toLowerCase(),'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-').concat(a.id,'" role="button"></div></div>'));var f="";l>=0&&(t=" fr-active",s>=0&&l>s&&(t=""),f='<div class="fr-image-by-url-layer'.concat(t,' fr-layer" id="fr-image-by-url-layer-').concat(a.id,'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-').concat(a.id,'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">').concat(a.language.translate("Insert"),"</button></div></div>"));var c={buttons:n,upload_layer:g,by_url_layer:f,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'};return a.opts.imageInsertButtons.length>=1&&(r=a.popups.create("image.insert",c)),a.$wp&&a.events.$on(a.$wp,"scroll",function(){i&&a.popups.isVisible("image.insert")&&we()}),function(e){a.events.$on(e,"dragover dragenter",".fr-image-upload-layer",function(e){return p(this).addClass("fr-drop"),(a.browser.msie||a.browser.edge)&&e.preventDefault(),!1},!0),a.events.$on(e,"dragleave dragend",".fr-image-upload-layer",function(e){return p(this).removeClass("fr-drop"),(a.browser.msie||a.browser.edge)&&e.preventDefault(),!1},!0),a.events.$on(e,"drop",".fr-image-upload-layer",function(t){t.preventDefault(),t.stopPropagation(),p(this).removeClass("fr-drop");var i=t.originalEvent.dataTransfer;if(i&&i.files){var r=e.data("instance")||a;r.events.disableBlur(),r.image.upload(i.files),r.events.enableBlur()}},!0),a.helpers.isIOS()&&a.events.$on(e,"touchstart",'.fr-image-upload-layer input[type="file"]',function(){p(this).trigger("click")},!0),a.events.$on(e,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var t=e.data("instance")||a;t.events.disableBlur(),e.find("input:focus").blur(),t.events.enableBlur(),t.image.upload(this.files,i)}p(this).val("")},!0)}(r),r}function J(){i&&a.popups.get("image.alt").find("input").val(i.attr("alt")||"").trigger("change")}function Q(){var e=a.popups.get("image.alt");e||(e=Z()),O(),a.popups.refresh("image.alt"),a.popups.setContainer("image.alt",a.$sc);var t=Se(),r=t.outerWidth()/2;Ee()&&(t=t.find(".fr-img-wrap"),r=i.outerWidth()/2);var n=t.offset().left+r,o=t.offset().top+t.outerHeight(),s=t.outerHeight();a.opts.iframe&&Ee()&&(s=i?i.outerHeight():0),a.popups.show("image.alt",n,o,s,!0)}function Z(e){if(e)return a.popups.onRefresh("image.alt",J),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'.concat(a.button.buildList(a.opts.imageAltButtons),"</div>"),alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'.concat(a.id,'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-').concat(a.id,'" type="text" placeholder="').concat(a.language.translate("Alternative Text"),'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">').concat(a.language.translate("Update"),"</button></div></div>")},r=a.popups.create("image.alt",t);return a.$wp&&a.events.$on(a.$wp,"scroll.image-alt",function(){i&&a.popups.isVisible("image.alt")&&Q()}),r}function ee(){var e=a.popups.get("image.size"),t=i.get(0).style.height?i.get(0).style.height:"auto",r=i.get(0).style.width?i.get(0).style.width:"auto";if(i)if(Ee()){var n=i.parent();n.get(0).style.width||(n=i.parent().parent()),e.find('input[name="width"]').val(r).trigger("change"),e.find('input[name="height"]').val(t).trigger("change")}else e.find('input[name="width"]').val(r).trigger("change"),e.find('input[name="height"]').val(t).trigger("change")}function te(){var e=a.popups.get("image.size");e||(e=ae()),O(),a.popups.refresh("image.size"),a.popups.setContainer("image.size",a.$sc);var t=Se(),r=t.outerWidth()/2;Ee()&&(t=t.find(".fr-img-wrap"),r=i.outerWidth()/2);var n=t.outerHeight();a.opts.iframe&&Ee()&&(n=i?i.outerHeight():0);var o=t.offset().left+r,s=t.offset().top+t.outerHeight();a.popups.show("image.size",o,s,n,!0)}function ae(e){if(e)return a.popups.onRefresh("image.size",ee),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'.concat(a.button.buildList(a.opts.imageSizeButtons),"</div>"),size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'.concat(a.id,'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-\'').concat(a.id,'" type="text" name="width" placeholder="').concat(a.language.translate("Width"),'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height').concat(a.id,'" type="text" name="height" placeholder="').concat(a.language.translate("Height"),'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">').concat(a.language.translate("Update"),"</button></div></div>")},r=a.popups.create("image.size",t);return a.$wp&&a.events.$on(a.$wp,"scroll.image-size",function(){i&&a.popups.isVisible("image.size")&&te()}),r}function ie(e,t,a,i){return e.pageX=t,$.call(this,e),e.pageX=e.pageX+a*Math.floor(Math.pow(1.1,i)),I.call(this,e),P.call(this,e),++i}function re(t){if(t=t||Se(),a.opts.trackChangesEnabled&&!a.helpers.isMobile()&&(!t[0].parentNode||"SPAN"!==t[0].parentNode.tagName||!t[0].parentNode.hasAttribute("data-tracking")))return a.track_changes.removeSpecialItem(t),a.popups.hideAll(),void de(!0);t&&!1!==a.events.trigger("image.beforeRemove",[t])&&(a.popups.hideAll(),Ae(),de(!0),a.undo.canDo()||a.undo.saveStep(),t.get(0)==a.el?t.removeAttr("src"):(t.get(0).parentNode&&"A"==t.get(0).parentNode.tagName?(a.selection.setBefore(t.get(0).parentNode)||a.selection.setAfter(t.get(0).parentNode)||t.parent().after(e.MARKERS),p(t.get(0).parentNode).remove()):(a.selection.setBefore(t.get(0))||a.selection.setAfter(t.get(0))||t.after(e.MARKERS),t.remove()),a.html.fillEmptyBlocks(),a.selection.restore()),a.undo.saveStep())}function ne(t){var r=t.which;if(i&&(r==e.KEYCODE.BACKSPACE||r==e.KEYCODE.DELETE))return t.preventDefault(),t.stopPropagation(),re(),!1;if(i&&r==e.KEYCODE.ESC){var n=i;return de(!0),a.selection.setAfter(n.get(0)),a.selection.restore(),t.preventDefault(),!1}if(i&&(r==e.KEYCODE.ARROW_LEFT||r==e.KEYCODE.ARROW_RIGHT)){var o=i.get(0);return de(!0),r==e.KEYCODE.ARROW_LEFT?a.selection.setBefore(o):a.selection.setAfter(o),a.selection.restore(),t.preventDefault(),!1}return i&&r===e.KEYCODE.TAB?(t.preventDefault(),t.stopPropagation(),de(!0),!1):i&&r!=e.KEYCODE.F10&&!a.keys.isBrowserAction(t)?(t.preventDefault(),t.stopPropagation(),!1):void 0}function oe(e){if(e&&"IMG"==e.tagName){if(a.node.hasClass(e,"fr-uploading")||a.node.hasClass(e,"fr-error")?e.parentNode.removeChild(e):a.node.hasClass(e,"fr-draggable")&&e.classList.remove("fr-draggable"),e.parentNode&&e.parentNode.parentNode&&a.node.hasClass(e.parentNode.parentNode,"fr-img-caption")){var t=e.parentNode.parentNode;t.removeAttribute("contenteditable"),t.removeAttribute("draggable"),t.classList.remove("fr-draggable");var i=e.nextSibling;i&&i.removeAttribute("contenteditable")}}else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var r=e.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),n=0;n<r.length;n++)oe(r[n])}function se(e){if(!1===a.events.trigger("image.beforePasteUpload",[e]))return p(e).removeAttr("data-fr-image-pasted"),!1;i=p(e),x(),A(),we(),B(),i.on("load",function(){var e=[];x(),p(a.popups.get("image.insert").get(0)).find("div.fr-active.fr-error").length<1&&B(),p(this).data("events").filter(function(t){"load"===t[0]&&e.push(t)}),e.length<=1&&p(this).off("load")});for(var t=p(e).attr("src").split(","),r=atob(t[1]),n=[],o=0;o<r.length;o++)n.push(r.charCodeAt(o));X([a.browser.safari&&!a.opts.imageUploadURL?new Blob([new Uint8Array(n)],{type:t[0].replace(/data\:/g,"")}):new Blob([new Uint8Array(n)],{type:t[0].replace(/data\:/g,"").replace(/;base64/g,"")})],i)}function le(){a.opts.imagePaste?a.$el.find("img[data-fr-image-pasted]").each(function(t,i){if(a.opts.imagePasteProcess){var r=a.opts.imageDefaultWidth;r&&"auto"!=r&&(r+=a.opts.imageResizeWithPercent?"%":"px"),p(i).css("width",r).removeClass("fr-dii fr-dib fr-fir fr-fil"),ve(p(i),a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign)}if(0===i.src.indexOf("data:"))se(i);else if(0===i.src.indexOf("blob:")||0===i.src.indexOf("http")&&a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){var t=a.o_doc.createElement("CANVAS"),r=t.getContext("2d");t.height=this.naturalHeight,t.width=this.naturalWidth,r.drawImage(this,0,0),setTimeout(function(){se(i)},0),i.src=t.toDataURL(e.IMAGE_TYPE)},a.browser.msie&&e.IMAGE_ALLOW_REGEX.test(i.src)&&(e.IMAGE_TYPE="image/"+i.src.split(e.IMAGE_ALLOW_REGEX)[1]),n.src=(0===i.src.indexOf("blob:")?"":"".concat(a.opts.imageCORSProxy,"/"))+i.src,0!==i.src.indexOf("blob:")&&a.undo.saveStep()}else 0!==i.src.indexOf("http")||0===i.src.indexOf("https://mail.google.com/mail")?(a.selection.save(),p(i).remove(),a.selection.restore()):p(i).removeAttr("data-fr-image-pasted")}):a.$el.find("img[data-fr-image-pasted]").remove()}function pe(e){var t=e.target.result,i=a.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=a.opts.imageResizeWithPercent?"%":"px"),a.undo.saveStep(),a.html.insert('<img data-fr-image-pasted="true" src="'.concat(t,'"').concat(i?' style="width: '.concat(i,';"'):"",">"));var r=a.$el.find('img[data-fr-image-pasted="true"]');r&&ve(r,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign),a.events.trigger("paste.after")}function ge(e){if(e&&e.clipboardData&&e.clipboardData.items){var t=null;if(e.clipboardData.types&&-1!=[].indexOf.call(e.clipboardData.types,"text/rtf")||e.clipboardData.getData("text/rtf"))t=e.clipboardData.items[0].getAsFile();else for(var a=0;a<e.clipboardData.items.length&&!(t=e.clipboardData.items[a].getAsFile());a++);if(t)return function(e){var t=new FileReader;t.onload=pe,t.readAsDataURL(e)}(t),!1}}function fe(e){return e=e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function ce(t){if("false"==p(this).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(t&&"touchend"==t.type&&l)return!0;if(t&&a.edit.isDisabled())return t.stopPropagation(),t.preventDefault(),!1;for(var r=0;r<e.INSTANCES.length;r++)e.INSTANCES[r]!=a&&e.INSTANCES[r].events.trigger("image.hideResizer");a.toolbar.disable(),t&&(t.stopPropagation(),t.preventDefault()),a.helpers.isMobile()&&(a.events.disableBlur(),a.$el.blur(),a.events.enableBlur()),a.opts.iframe&&a.size.syncIframe(),i=p(this),Ae(),x(),A(),a.browser.msie?(a.popups.areVisible()&&a.events.disableBlur(),a.win.getSelection&&(a.win.getSelection().removeAllRanges(),a.win.getSelection().addRange(a.doc.createRange()))):a.selection.clear(),a.helpers.isIOS()&&(a.events.disableBlur(),a.$el.blur()),a.button.bulkRefresh(),a.events.trigger("video.hideResizer")}function de(e){i&&(ue||!0===e)&&(a.toolbar.enable(),r.removeClass("fr-active"),a.popups.hideAll(),i=null,he(),n=null,o&&o.hide())}b[c]="Image cannot be loaded from the passed link.",b[d]="No link in upload response.",b[u]="Error during file upload.",b[m]="Parsing response failed.",b[h]="File is too large.",b[v]="Image file type is invalid.",b[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",b[8]="Image file is corrupted.";var ue=!1;function me(){ue=!0}function he(){ue=!1}function ve(e,t,i){!a.opts.htmlUntouched&&a.opts.useClasses?(e.removeClass("fr-fil fr-fir fr-dib fr-dii"),i&&e.addClass("fr-fi".concat(i[0])),t&&e.addClass("fr-di".concat(t[0]))):"inline"==t?(e.css({display:"inline-block",verticalAlign:"bottom",margin:a.opts.imageDefaultMargin}),"center"==i?e.css({float:"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - ".concat(2*a.opts.imageDefaultMargin,"px)"),textAlign:"center"}):"left"==i?e.css({float:"left",marginLeft:0,maxWidth:"calc(100% - ".concat(a.opts.imageDefaultMargin,"px)"),textAlign:"left"}):e.css({float:"right",marginRight:0,maxWidth:"calc(100% - ".concat(a.opts.imageDefaultMargin,"px)"),textAlign:"right"})):"block"==t&&(e.css({display:"block",float:"none",verticalAlign:"top",margin:"".concat(a.opts.imageDefaultMargin,"px auto"),textAlign:"center"}),"left"==i?e.css({marginLeft:0,textAlign:"left"}):"right"==i&&e.css({marginRight:0,textAlign:"right"}))}function be(e){if(void 0===e&&(e=Se()),e){if(e.hasClass("fr-fil"))return"left";if(e.hasClass("fr-fir"))return"right";if(e.hasClass("fr-dib")||e.hasClass("fr-dii"))return"center";var t=e.css("float");if(e.css("float","none"),"block"==e.css("display")){if(e.css("float",""),e.css("float")!=t&&e.css("float",t),0===parseInt(e.css("margin-left"),10))return"left";if(0===parseInt(e.css("margin-right"),10))return"right"}else{if(e.css("float",""),e.css("float")!=t&&e.css("float",t),"left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function ye(e){void 0===e&&(e=Se());var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function we(){var e=a.popups.get("image.insert");e||(e=j()),a.popups.isVisible("image.insert")||(O(),a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$sc));var t=Se(),r=t.outerWidth()/2;Ee()&&(t=t.find(".fr-img-wrap"),r=i.outerWidth()/2);var n=t.offset().left+r,o=t.outerHeight(!0);a.opts.iframe&&Ee()&&(o=i?i.outerHeight():0);var s=t.offset().top+t.outerHeight();a.popups.show("image.insert",n,s,o,!0)}function Ae(){if(i){a.events.disableBlur(),a.selection.clear();var e=a.doc.createRange();e.selectNode(i.get(0)),a.browser.msie&&e.collapse(!0),a.selection.get().addRange(e),a.events.enableBlur()}}function Ce(){return i}function Se(){return Ee()?i.parents(".fr-img-caption").first():i}function Ee(){return!!i&&i.parents(".fr-img-caption").length>0}function Re(e){for(var t=document.createDocumentFragment();e.firstChild;){var a=e.removeChild(e.firstChild);t.appendChild(a)}e.parentNode.replaceChild(t,e)}return{_init:function(){var t;a.events.$on(a.$el,a._mousedown,"IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==p(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;a.helpers.isMobile()||a.selection.clear(),f=!0,a.popups.areVisible()&&a.events.disableBlur(),a.browser.msie&&(a.events.disableBlur(),a.$el.attr("contenteditable",!1)),a.draggable||"touchstart"==e.type||e.preventDefault(),e.stopPropagation()}),a.events.$on(a.$el,a._mousedown,".fr-img-caption .fr-inner",function(e){a.core.hasFocus()||a.events.focus(),e.stopPropagation()}),a.events.$on(a.$el,"paste",".fr-img-caption .fr-inner",function(e){!0===a.opts.toolbarInline&&(a.toolbar.hide(),e.stopPropagation())}),a.events.$on(a.$el,a._mouseup,"IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==p(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;f&&(f=!1,e.stopPropagation(),a.browser.msie&&(a.$el.attr("contenteditable",!0),a.events.enableBlur()))}),a.events.on("keyup",function(e){if(e.shiftKey&&""===a.selection.text().replace(/\n/g,"")&&a.keys.isArrow(e.which)){var t=a.selection.element(),i=a.selection.endElement();t&&"IMG"==t.tagName?_(p(t)):i&&"IMG"==i.tagName&&_(p(i))}},!0),a.events.on("drop",q),a.events.on("element.beforeDrop",F),a.events.on("mousedown window.mousedown",me),a.events.on("window.touchmove",he),a.events.on("mouseup window.mouseup",function(){if(i&&!a.helpers.isMobile())return de(),!1;he()}),a.events.on("commands.mousedown",function(e){e.parents(".fr-toolbar").length>0&&de()}),a.events.on("image.resizeEnd",function(){a.opts.iframe&&a.size.syncIframe()}),a.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){f=!1,de(!0)}),a.events.on("modals.hide",function(){i&&(Ae(),a.selection.clear())}),a.events.on("image.resizeEnd",function(){a.win.getSelection&&_(i)}),a.opts.imageAddNewLine&&a.events.on("image.inserted",function(t){var i=t.get(0);for(i.nextSibling&&"BR"===i.nextSibling.tagName&&(i=i.nextSibling);i&&!a.node.isElement(i);)i=a.node.isLastSibling(i)?i.parentNode:null;a.node.isElement(i)&&(a.opts.enter===e.ENTER_BR?t.after("<br>"):p(a.node.blockParent(t.get(0))).after("<".concat(a.html.defaultTag(),"><br></").concat(a.html.defaultTag(),">")))}),"IMG"==a.el.tagName&&a.$el.addClass("fr-view"),a.events.$on(a.$el,a.helpers.isMobile()&&!a.helpers.isWindowsPhone()?"touchend":"click","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',ce),a.helpers.isMobile()&&(a.events.$on(a.$el,"touchstart","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(){l=!1}),a.events.$on(a.$el,"touchmove",function(){l=!0})),a.$wp?(a.events.on("window.keydown keydown",ne,!0),a.events.on("keyup",function(t){if(i&&t.which==e.KEYCODE.ENTER)return!1},!0),a.events.$on(a.$el,"keydown",function(){var t=a.selection.element();(t.nodeType===Node.TEXT_NODE||"BR"==t.tagName&&a.node.isLastSibling(t))&&(t=t.parentNode),a.node.hasClass(t,"fr-inner")||(a.node.hasClass(t,"fr-img-caption")||(t=p(t).parents(".fr-img-caption").get(0)),a.node.hasClass(t,"fr-img-caption")&&(a.opts.trackChangesEnabled||p(t).after(e.INVISIBLE_SPACE+e.MARKERS),a.selection.restore()))})):a.events.$on(a.$win,"keydown",ne),a.events.on("toolbar.esc",function(){if(i){if(a.$wp)a.events.disableBlur(),a.events.focus();else{var e=i;de(!0),a.selection.setAfter(e.get(0)),a.selection.restore()}return!1}},!0),a.events.on("toolbar.focusEditor",function(){if(i)return!1},!0),a.events.on("window.cut window.copy",function(t){if(i&&a.popups.isVisible("image.edit")&&!a.popups.get("image.edit").find(":focus").length){var r=Se();Ee()?(r.before(e.START_MARKER),r.after(e.END_MARKER),a.selection.restore(),a.paste.saveCopiedText(r.get(0).outerHTML,r.text())):(Ae(),a.paste.saveCopiedText(i.get(0).outerHTML,i.attr("alt"))),"copy"==t.type?setTimeout(function(){_(i)}):(de(!0),a.undo.saveStep(),setTimeout(function(){a.undo.saveStep()},0))}},!0),a.browser.msie&&a.events.on("keydown",function(t){if(!a.selection.isCollapsed()||!i)return!0;var r=t.which;r==e.KEYCODE.C&&a.keys.ctrlKey(t)?a.events.trigger("window.copy"):r==e.KEYCODE.X&&a.keys.ctrlKey(t)&&a.events.trigger("window.cut")}),a.events.$on(p(a.o_win),"keydown",function(t){var a=t.which;if(i&&a==e.KEYCODE.BACKSPACE)return t.preventDefault(),!1}),a.events.$on(a.$win,"keydown",function(t){var a=t.which;i&&i.hasClass("fr-uploading")&&a==e.KEYCODE.ESC&&i.trigger("abortUpload")}),a.events.on("destroy",function(){i&&i.hasClass("fr-uploading")&&i.trigger("abortUpload")}),a.events.on("paste.before",ge),a.events.on("paste.beforeCleanup",fe),a.events.on("paste.after",le),a.events.on("html.set",R),a.events.on("html.inserted",R),R(),a.events.on("destroy",function(){s=[]}),a.events.on("html.processGet",oe),a.opts.imageOutputSize&&a.events.on("html.beforeGet",function(){t=a.el.querySelectorAll("img");for(var e=0;e<t.length;e++){var i=t[e].style.width||p(t[e]).width(),r=t[e].style.height||p(t[e]).height();i&&t[e].setAttribute("width","".concat(i).replace(/px/,"")),r&&t[e].setAttribute("height","".concat(r).replace(/px/,""))}}),a.opts.iframe&&a.events.on("image.loaded",a.size.syncIframe),a.$wp&&(U(),a.events.on("contentChanged",U)),a.events.$on(p(a.o_win),"orientationchange.image",function(){setTimeout(function(){i&&_(i)},100)}),N(!0),j(!0),ae(!0),Z(!0),a.events.on("node.remove",function(e){if("IMG"==e.get(0).tagName)return re(e),!1})},showInsertPopup:function(){var e=a.$tb.find('.fr-command[data-cmd="insertImage"]'),t=a.popups.get("image.insert");if(t||(t=j()),O(),!t.hasClass("fr-active"))if(a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$tb),e.isVisible()){var i=a.button.getPosition(e),r=i.left,n=i.top;a.popups.show("image.insert",r,n,e.outerHeight())}else a.position.forSelection(t),a.popups.show("image.insert")},showLayer:function(e){var t,r,n=a.popups.get("image.insert");if(i||a.opts.toolbarInline){if(i){var o=Se(),s=0;Ee()&&(o=o.find(".fr-img-wrap"),s=i.outerWidth()/2),r=o.offset().top+o.outerHeight(),t=o.offset().left+s}}else{var l=a.$tb.find('.fr-command[data-cmd="insertImage"]');t=l.offset().left,r=l.offset().top+(a.opts.toolbarBottom?10:l.outerHeight()-10)}!i&&a.opts.toolbarInline&&(r=n.offset().top-a.helpers.getPX(n.css("margin-top")),n.hasClass("fr-above")&&(r+=n.outerHeight())),n.find(".fr-layer").removeClass("fr-active"),n.find(".fr-".concat(e,"-layer")).addClass("fr-active"),a.popups.show("image.insert",t,r,i?i.outerHeight():0,Ee()),a.accessibility.focusPopup(n)},refreshUploadButton:function(e){var t=a.popups.get("image.insert");t&&t.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function(e){var t=a.popups.get("image.insert");t&&t.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:X,insertByURL:function(){var e=a.popups.get("image.insert").find(".fr-image-by-url-layer input");if(e.val().length>0){B(),z(a.language.translate("Loading image"));var t=e.val().trim();if(a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy&&a.opts.imageUpload){var r=new XMLHttpRequest;r.onload=function(){200==this.status?X([new Blob([this.response],{type:this.response.type||"image/png"})],i):k(c)},r.onerror=function(){K(t,!0,[],i)},r.open("GET","".concat(a.opts.imageCORSProxy,"/").concat(t),!0),r.responseType="blob",r.send()}else K(t,!0,[],i);e.val(""),e.blur()}},align:function(e){var t=Se();t.removeClass("fr-fir fr-fil"),!a.opts.htmlUntouched&&a.opts.useClasses?"left"==e?t.addClass("fr-fil"):"right"==e&&t.addClass("fr-fir"):ve(t,ye(),e),Ae(),x(),A(),a.selection.clear()},refreshAlign:function(e){i&&e.find("> *").first().replaceWith(a.icon.create("image-align-".concat(be())))},refreshAlignOnShow:function(e,t){i&&t.find('.fr-command[data-param1="'.concat(be(),'"]')).addClass("fr-active").attr("aria-selected",!0)},display:function(e){var t=Se();t.removeClass("fr-dii fr-dib"),!a.opts.htmlUntouched&&a.opts.useClasses?"inline"==e?t.addClass("fr-dii"):"block"==e&&t.addClass("fr-dib"):ve(t,e,be()),Ae(),x(),A(),a.selection.clear()},refreshDisplayOnShow:function(e,t){i&&t.find('.fr-command[data-param1="'.concat(ye(),'"]')).addClass("fr-active").attr("aria-selected",!0)},replace:we,back:function(){i?(a.events.disableBlur(),p(".fr-popup input:focus").blur(),_(i)):(a.events.disableBlur(),a.selection.restore(),a.events.enableBlur(),a.popups.hide("image.insert"),a.toolbar.showInline())},get:Ce,getEl:Se,insert:K,showProgressBar:B,remove:re,hideProgressBar:O,applyStyle:function(e,r,n){if(void 0===r&&(r=a.opts.imageStyles),void 0===n&&(n=a.opts.imageMultipleStyles),!i)return!1;var o=Se();if(!n){var s=Object.keys(r);s.splice(s.indexOf(e),1),o.removeClass(s.join(" "))}"object"==t(r[e])?(o.removeAttr("style"),o.css(r[e].style)):o.toggleClass(e),_(i)},showAltPopup:Q,showSizePopup:te,setAlt:function(e){if(i){var t=a.popups.get("image.alt");i.attr("alt",e||t.find("input").val()||""),t.find("input:focus").blur(),_(i)}},setSize:function(e,t){if(i){var r=a.popups.get("image.size");e=e||r.find('input[name="width"]').val()||"",t=t||r.find('input[name="height"]').val()||"";var n=/^[\d]+((px)|%)*$/g;i.removeAttr("width").removeAttr("height"),e.match(n)?i.css("width",e):i.css("width",""),t.match(n)?i.css("height",t):i.css("height",""),Ee()&&(i.parents(".fr-img-caption").removeAttr("width").removeAttr("height"),e.match(n)?i.parents(".fr-img-caption").css("width",e):i.parents(".fr-img-caption").css("width",""),t.match(n)?i.parents(".fr-img-caption").css("height",t):i.parents(".fr-img-caption").css("height","")),r&&r.find("input:focus").blur(),_(i)}},toggleCaption:function(){var t;if(i&&!Ee()){t=i,i.parent().is("a")&&(t=i.parent());var r,n,o=i.parents("ul")&&i.parents("ul").length>0?i.parents("ul"):i.parents("ol")&&i.parents("ol").length>0?i.parents("ol"):[];if(o.length>0){var s=o.find("li").length,l=i.parents("li"),p=document.createElement("li");s-1===l.index()&&(o.append(p),p.innerHTML="&nbsp;")}t.attr("style")?n=(r=t.attr("style").split(":")).indexOf("width")>-1?r[r.indexOf("width")+1].replace(";",""):"":t.attr("width")&&(n=t.attr("width"));var g=a.opts.imageResizeWithPercent?(n.indexOf("px")>-1?null:n)||"100%":i.width()+"px";t.wrap('<div class="fr-img-space-wrap"><span '+(a.browser.mozilla?"":'contenteditable="false"')+'class="fr-img-caption '+i.attr("class")+'" style="'+(a.opts.useClasses?"":t.attr("style"))+'" draggable="false"></span></div>'),t.wrap('<span class="fr-img-wrap"></span>'),i.after('<span class="fr-inner"'.concat(a.browser.mozilla?"":' contenteditable="true"',">").concat(e.START_MARKER).concat(a.language.translate("Image Caption")).concat(e.END_MARKER,"</span>")),i.parents(".fr-img-caption").css("width",g);var f=i.parents(".fr-img-space-wrap").length;1==f?Re(document.querySelector(".fr-img-space-wrap")):f>1&&(Re(document.querySelector(".fr-img-space-wrap")),Re(document.querySelector(".fr-img-space-wrap2"))),de(!0),a.selection.restore()}else{if(t=Se(),i.insertBefore(t),null!==t[0].querySelector("a")){for(var c,d=t[0].querySelector("a"),u=document.createElement("a"),m=0,h=d.attributes,v=h.length;m<v;m++)c=h[m],u.setAttribute(c.nodeName,c.nodeValue);i.wrap(u)}i.attr("class",t.attr("class").replace("fr-img-caption","")).attr("style",t.attr("style")),t.remove();var b=i.parents(".fr-img-space-wrap").length;1==b?Re(document.querySelector(".fr-img-space-wrap")):b>1&&(Re(document.querySelector(".fr-img-space-wrap")),Re(document.querySelector(".fr-img-space-wrap2"))),_(i)}},hasCaption:Ee,exitEdit:de,edit:_}},e.DefineIcon("insertImage",{NAME:"image",SVG_KEY:"insertImage"}),e.RegisterShortcut(e.KEYCODE.P,"insertImage",null,"P"),e.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),e.DefineIcon("imageUpload",{NAME:"upload",SVG_KEY:"upload"}),e.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.DefineIcon("imageByURL",{NAME:"link",SVG_KEY:"insertLink"}),e.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){this.image.get()?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),e.DefineIcon("imageDisplay",{NAME:"star",SVG_KEY:"imageDisplay"}),e.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.DefineIcon("image-align",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("image-align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("image-align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),e.DefineIcon("image-align-center",{NAME:"align-justify",SVG_KEY:"alignCenter"}),e.DefineIcon("imageAlign",{NAME:"align-justify",SVG_KEY:"alignJustify"}),e.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.imageAlign.options;for(var i in a)a.hasOwnProperty(i)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'.concat(i,'" title="').concat(this.language.translate(a[i]),'">').concat(this.icon.create("image-align-".concat(i)),'<span class="fr-sr-only">').concat(this.language.translate(a[i]),"</span></a></li>"));return t+="</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt",SVG_KEY:"replaceImage"}),e.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.DefineIcon("imageRemove",{NAME:"trash",SVG_KEY:"remove"}),e.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.DefineIcon("imageBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){this.$;this.image.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),e.DefineIcon("imageStyle",{NAME:"magic",SVG_KEY:"imageClass"}),e.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',a=this.opts.imageStyles;for(var i in a)if(a.hasOwnProperty(i)){var r=a[i];"object"==t(r)&&(r=r.title),e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'.concat(i,'">').concat(this.language.translate(r),"</a></li>")}return e+="</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(e,t){var a=this.$,i=this.image.getEl();i&&t.find(".fr-command").each(function(){var e=a(this).data("param1"),t=i.hasClass(e);a(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),e.DefineIcon("imageAlt",{NAME:"info",SVG_KEY:"imageAltText"}),e.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}}),e.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.DefineIcon("imageSize",{NAME:"arrows-alt",SVG_KEY:"imageSize"}),e.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}}),e.DefineIcon("imageCaption",{NAME:"commenting",FA5NAME:"comment-alt",SVG_KEY:"imageCaption"}),e.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function(e){this.image.get()&&e.toggleClass("fr-active",this.image.hasCaption())}})});